<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriSmart - Pengaturan Sistem</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="pengaturan.css">
    <link rel="stylesheet" href="css/darkmode.css">
    
    <!-- Language Files -->
    <script src="lang/Id.js"></script>
    <script src="lang/En.js"></script>
    <script src="lang/Language.js"></script>
    
    <!-- Dark Mode -->
    <script src="js/darkmode.js"></script>
</head>
<body>
    <!-- Floating Leaves Background -->
    <div id="leaves-container"></div>

    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%232c7a2c' opacity='0.8'/><path fill='%23ffffff' d='M50 20 Q70 50 50 80 Q30 50 50 20 Z'/><circle cx='50' cy='50' r='15' fill='%23ffffff'/><path fill='%232c7a2c' d='M50 35 Q55 50 50 65 Q45 50 50 35 Z'/></svg>" 
                     alt="AgriSmart Logo" class="logo">
                <h1 data-lang="settings.title">AgriSmart Pengaturan Sistem</h1>
            </div>
            <p data-lang="settings.subtitle">Pengaturan Sistem - Konfigurasi dan Personalisasi</p>
            
            <!-- User Menu -->
            <div class="user-menu" id="user-menu">
                <div class="user-info" onclick="toggleUserDropdown()">
                    <div class="user-avatar" id="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <span class="user-name" id="user-name">Pengguna</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="user-dropdown" id="user-dropdown">
                    <div class="dropdown-header">
                        <strong id="dropdown-fullname">Nama Pengguna</strong>
                        <small id="dropdown-email">email@example.com</small>
                    </div>
                    <a href="PROFIL/profil.html" class="dropdown-item">
                        <i class="fas fa-user-circle"></i> <span data-lang="common.myProfile">Profil Saya</span>
                    </a>
                    <hr>
                    <a href="#" class="dropdown-item logout" onclick="logout(); return false;">
                        <i class="fas fa-sign-out-alt"></i> <span data-lang="common.logout">Keluar</span>
                    </a>
                </div>
            </div>
            
            <div class="nav-container">
                <ul class="nav-links">
                    <li><a href="index.html" data-lang="nav.dashboard">Dashboard</a></li>
                    <li><a href="monitoring.html" data-lang="nav.monitoring">Monitoring</a></li>
                    <li><a href="kontrol.html" data-lang="nav.control">Kontrol</a></li>
                    <li><a href="laporan.html" data-lang="nav.reports">Laporan</a></li>
                    <li><a href="pengaturan.html" class="active" data-lang="nav.settings">Pengaturan</a></li>
                </ul>
            </div>
        </div>

        <div class="settings-container">
            
            <!-- ============================================
                 KELOLA PERANGKAT (DEVICE MANAGEMENT)
                 ============================================ -->
            <div class="settings-section">
                <h2 class="section-title">
                    <span class="section-icon"><i class="fas fa-microchip"></i></span>
                    <span data-lang="settings.deviceManagement">Kelola Perangkat</span>
                </h2>
                
                <div class="device-info-box">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <p><strong data-lang="settings.howToAddDevice">Cara Menambahkan Perangkat:</strong></p>
                        <ol style="margin-left: 20px; margin-top: 8px; line-height: 1.8;">
                            <li data-lang="settings.step1">Upload kode ke ESP32/ESP32-CAM</li>
                            <li data-lang="settings.step2">Buka Serial Monitor (115200 baud)</li>
                            <li><span data-lang="settings.step3">Catat <strong>Device ID</strong> yang muncul (contoh: SPR-A1B2C3D4E5F6)</span></li>
                            <li data-lang="settings.step4">Masukkan Device ID di form bawah ini</li>
                        </ol>
                        <p style="margin-top: 10px; color: #888;"><i class="fas fa-lightbulb"></i> <span data-lang="settings.deviceIdInfo">Device ID berbasis MAC Address, unik dan tidak akan berubah meski perangkat di-reset.</span></p>
                    </div>
                </div>
                
                <!-- User ID Display -->
                <div class="user-id-section">
                    <div class="user-id-box">
                        <div class="user-id-info">
                            <span class="user-id-label"><i class="fas fa-id-badge"></i> <span data-lang="settings.yourUserId">User ID Anda</span>:</span>
                            <span class="user-id-value" id="settings-user-id">Loading...</span>
                        </div>
                        <button type="button" class="copy-btn" onclick="copyUserId()">
                            <i class="fas fa-copy"></i> <span data-lang="common.copy">Salin</span>
                        </button>
                    </div>
                    <p class="user-id-hint" data-lang="settings.userIdHint">User ID ini diperlukan saat konfigurasi perangkat ESP32 (ketik SETUSER:&lt;UserID&gt; di Serial Monitor)</p>
                </div>

                <!-- Daftar Perangkat Penyiram (Sprinkler) -->
                <div class="device-category">
                    <div class="device-category-header">
                        <div class="device-category-title">
                            <i class="fas fa-tint"></i>
                            <span data-lang="settings.sprinklerDevice">Alat Penyiram (ESP32)</span>
                        </div>
                        <button class="btn btn-add-device" onclick="openAddDeviceModal('sprinkler')">
                            <i class="fas fa-plus"></i> <span data-lang="settings.addSprinkler">Tambah Penyiram</span>
                        </button>
                    </div>
                    
                    <div class="device-list" id="sprinkler-device-list">
                        <!-- Device cards will be rendered here by JavaScript -->
                        <div class="device-empty" id="sprinkler-empty">
                            <i class="fas fa-tint-slash"></i>
                            <p data-lang="settings.noSprinklerConnected">Belum ada alat penyiram yang terhubung</p>
                            <button class="btn btn-add-first" onclick="openAddDeviceModal('sprinkler')">
                                <i class="fas fa-plus"></i> <span data-lang="settings.addFirstSprinkler">Tambah Penyiram Pertama</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Daftar Perangkat Kamera (Camera) -->
                <div class="device-category">
                    <div class="device-category-header">
                        <div class="device-category-title">
                            <i class="fas fa-video"></i>
                            <span data-lang="settings.cameraDevice">Kamera (ESP32-CAM)</span>
                        </div>
                        <button class="btn btn-add-device" onclick="openAddDeviceModal('camera')">
                            <i class="fas fa-plus"></i> <span data-lang="settings.addCamera">Tambah Kamera</span>
                        </button>
                    </div>
                    
                    <div class="device-list" id="camera-device-list">
                        <!-- Device cards will be rendered here by JavaScript -->
                        <div class="device-empty" id="camera-empty">
                            <i class="fas fa-video-slash"></i>
                            <p data-lang="settings.noCameraConnected">Belum ada kamera yang terhubung</p>
                            <button class="btn btn-add-first" onclick="openAddDeviceModal('camera')">
                                <i class="fas fa-plus"></i> <span data-lang="settings.addFirstCamera">Tambah Kamera Pertama</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pengaturan Koneksi IoT -->
            <div class="settings-section">
                <h2 class="section-title">
                    <span class="section-icon"><i class="fas fa-wifi"></i></span>
                    <span data-lang="settings.iotConnection">Pengaturan Koneksi IoT</span>
                </h2>
                
                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.esp32IpDefault">IP Address ESP32 Default</div>
                        <div class="setting-description" data-lang="settings.esp32IpDesc">Alamat IP default untuk ESP32 baru</div>
                    </div>
                    <div class="input-group">
                        <input type="text" class="input-field" id="esp32-ip-setting" value="192.168.1.100" placeholder="192.168.1.100">
                        <button class="btn btn-small" onclick="testESP32Connection()">
                            <i class="fas fa-plug"></i> <span data-lang="common.test">Test</span>
                        </button>
                    </div>
                </div>

                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.websocketPort">WebSocket Port</div>
                        <div class="setting-description" data-lang="settings.websocketPortDesc">Port WebSocket untuk komunikasi real-time (default: 81)</div>
                    </div>
                    <input type="number" class="input-field" id="ws-port-setting" value="81" min="1" max="65535" style="width: 100px;">
                </div>
            </div>

            <!-- Pengaturan Umum -->
            <div class="settings-section">
                <h2 class="section-title">
                    <span class="section-icon"><i class="fas fa-cog"></i></span>
                    <span data-lang="settings.generalSettings">Pengaturan Umum</span>
                </h2>
                
                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.darkMode">Mode Gelap</div>
                        <div class="setting-description" data-lang="settings.darkModeDesc">Aktifkan tema gelap untuk mengurangi kelelahan mata</div>
                    </div>
                    <div class="toggle-switch" id="dark-mode-toggle" onclick="toggleDarkMode(this)">
                        <div class="toggle-slider"></div>
                    </div>
                </div>

                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.language">Bahasa Sistem</div>
                        <div class="setting-description" data-lang="settings.languageDesc">Pilih bahasa yang ingin digunakan</div>
                    </div>
                    <select class="select-field" id="language-select" onchange="changeLanguage(this.value)">
                        <option value="id" data-lang-option="settings.indonesian">üáÆüá© Bahasa Indonesia</option>
                        <option value="en" data-lang-option="settings.english">üá¨üáß English</option>
                    </select>
                </div>

                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.timezone">Zona Waktu</div>
                        <div class="setting-description" data-lang="settings.timezoneDesc">Atur zona waktu sesuai lokasi Anda</div>
                    </div>
                    <select class="select-field" name="timezone" id="timezone-select">
                        <option value="WIB" data-lang-option="settings.wib">WIB (GMT+7)</option>
                        <option value="WITA" data-lang-option="settings.wita">WITA (GMT+8)</option>
                        <option value="WIT" data-lang-option="settings.wit">WIT (GMT+9)</option>
                    </select>
                </div>
            </div>

            <!-- Pengaturan Sensor -->
            <div class="settings-section">
                <h2 class="section-title">
                    <span class="section-icon"><i class="fas fa-thermometer-half"></i></span>
                    <span data-lang="settings.sensorSettings">Pengaturan Sensor</span>
                </h2>
                
                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.sensorInterval">Interval Pembacaan Sensor</div>
                        <div class="setting-description" data-lang="settings.sensorIntervalDesc">Seberapa sering sensor membaca data (detik)</div>
                    </div>
                    <div class="input-group">
                        <input type="number" class="input-field" id="sensor-interval" value="5" min="1" max="60" style="width: 80px;">
                        <span class="input-suffix" data-lang="common.seconds">detik</span>
                    </div>
                </div>

                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.autoCalibration">Kalibrasi Otomatis</div>
                        <div class="setting-description" data-lang="settings.autoCalibrationDesc">Aktifkan kalibrasi sensor otomatis setiap hari</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSwitch(this)">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>

            <!-- Threshold Penyiraman Otomatis -->
            <div class="settings-section">
                <h2 class="section-title">
                    <span class="section-icon"><i class="fas fa-tint"></i></span>
                    <span data-lang="settings.autoWateringThreshold">Threshold Penyiraman Otomatis</span>
                </h2>
                
                <div class="threshold-info">
                    <i class="fas fa-info-circle"></i>
                    <p data-lang="settings.thresholdInfo">Atur batas kelembaban tanah untuk mengontrol penyiraman otomatis. Pompa akan MENYALA jika kelembaban di bawah threshold kering, dan MATI jika kelembaban mencapai threshold basah.</p>
                </div>

                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.humidityDry">Threshold Kelembaban Kering</div>
                        <div class="setting-description" data-lang="settings.humidityDryDesc">Pompa menyala jika kelembaban tanah di bawah nilai ini</div>
                    </div>
                    <div class="input-group">
                        <input type="number" class="input-field" id="threshold-humidity-dry" value="50" min="0" max="100" style="width: 80px;">
                        <span class="input-suffix">%</span>
                    </div>
                </div>

                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.humidityWet">Threshold Kelembaban Basah</div>
                        <div class="setting-description" data-lang="settings.humidityWetDesc">Pompa mati jika kelembaban tanah mencapai nilai ini</div>
                    </div>
                    <div class="input-group">
                        <input type="number" class="input-field" id="threshold-humidity-wet" value="70" min="0" max="100" style="width: 80px;">
                        <span class="input-suffix">%</span>
                    </div>
                </div>

                <div class="threshold-visual">
                    <div class="threshold-bar">
                        <div class="threshold-zone zone-dry">
                            <span>üî• <span data-lang="settings.zoneDry">Kering</span></span>
                            <span class="zone-value">&lt;50%</span>
                        </div>
                        <div class="threshold-zone zone-optimal">
                            <span>‚úÖ <span data-lang="settings.zoneOptimal">Optimal</span></span>
                            <span class="zone-value">50-70%</span>
                        </div>
                        <div class="threshold-zone zone-wet">
                            <span>üíß <span data-lang="settings.zoneWet">Basah</span></span>
                            <span class="zone-value">&gt;70%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Threshold pH Tanah -->
            <div class="settings-section">
                <h2 class="section-title">
                    <span class="section-icon"><i class="fas fa-flask"></i></span>
                    <span data-lang="settings.phThresholdTitle">Threshold pH Tanah</span>
                </h2>
                
                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.phAcidic">Batas pH Asam</div>
                        <div class="setting-description" data-lang="settings.phAcidicDesc">Alert jika pH tanah di bawah nilai ini (terlalu asam)</div>
                    </div>
                    <div class="input-group">
                        <input type="number" class="input-field" id="threshold-ph-acidic" value="5.5" min="0" max="14" step="0.1" style="width: 80px;">
                        <span class="input-suffix">pH</span>
                    </div>
                </div>

                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.phAlkaline">Batas pH Basa</div>
                        <div class="setting-description" data-lang="settings.phAlkalineDesc">Alert jika pH tanah di atas nilai ini (terlalu basa)</div>
                    </div>
                    <div class="input-group">
                        <input type="number" class="input-field" id="threshold-ph-alkaline" value="7.5" min="0" max="14" step="0.1" style="width: 80px;">
                        <span class="input-suffix">pH</span>
                    </div>
                </div>
            </div>

            <!-- Pengaturan Notifikasi -->
            <div class="settings-section">
                <h2 class="section-title">
                    <span class="section-icon"><i class="fas fa-bell"></i></span>
                    <span data-lang="settings.notificationSettings">Pengaturan Notifikasi</span>
                </h2>
                
                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.emailNotification">Notifikasi Email</div>
                        <div class="setting-description" data-lang="settings.emailNotificationDesc">Terima notifikasi penting melalui email</div>
                        <small style="color: #f59e0b; font-size: 0.75rem;">‚ö†Ô∏è <span data-lang="common.requiresBackend">Fitur ini membutuhkan backend server</span></small>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSwitch(this)" style="opacity: 0.5; pointer-events: none;">
                        <div class="toggle-slider"></div>
                    </div>
                </div>

                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.pushNotification">Notifikasi Push Browser</div>
                        <div class="setting-description" data-lang="settings.pushNotificationDesc">Terima notifikasi push di browser saat ada alert</div>
                    </div>
                    <div class="toggle-switch" id="push-notification-toggle" data-setting="push-notification" onclick="togglePushNotification(this)">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>

            <!-- Pengaturan Keamanan -->
            <div class="settings-section">
                <h2 class="section-title">
                    <span class="section-icon"><i class="fas fa-shield-alt"></i></span>
                    <span data-lang="settings.securitySettings">Pengaturan Keamanan</span>
                </h2>
                
                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.twoFactor">Autentikasi Dua Faktor</div>
                        <div class="setting-description" data-lang="settings.twoFactorDesc">Tingkatkan keamanan dengan verifikasi dua langkah</div>
                        <small style="color: #f59e0b; font-size: 0.75rem;">‚ö†Ô∏è <span data-lang="common.requiresBackend">Fitur ini membutuhkan backend server</span></small>
                    </div>
                    <div class="toggle-switch" onclick="toggleSwitch(this)" style="opacity: 0.5; pointer-events: none;">
                        <div class="toggle-slider"></div>
                    </div>
                </div>

                <div class="setting-item">
                    <div>
                        <div class="setting-label" data-lang="settings.sessionTimeout">Timeout Sesi</div>
                        <div class="setting-description" data-lang="settings.sessionTimeoutDesc">Waktu otomatis logout jika tidak ada aktivitas</div>
                    </div>
                    <select class="select-field" id="session-timeout-select" name="session-timeout" onchange="updateSessionTimeout(this.value)">
                        <option value="15">15 <span data-lang="settings.minutes">Menit</span></option>
                        <option value="30" selected>30 <span data-lang="settings.minutes">Menit</span></option>
                        <option value="60">1 <span data-lang="settings.hour">Jam</span></option>
                        <option value="120">2 <span data-lang="settings.hours">Jam</span></option>
                        <option value="0">‚ôæÔ∏è <span data-lang="common.stayConnected">Tetap Terhubung</span></option>
                    </select>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn" onclick="saveSettings()">
                    <i class="fas fa-save"></i> <span data-lang="settings.saveSettings">Simpan Pengaturan</span>
                </button>
                <button class="btn btn-secondary" onclick="exportSettings()">
                    <i class="fas fa-download"></i> <span data-lang="settings.exportSettings">Export Pengaturan</span>
                </button>
                <button class="btn btn-danger" onclick="resetSettings()">
                    <i class="fas fa-undo"></i> <span data-lang="settings.resetSettings">Reset ke Default</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================
         MODAL: TAMBAH PERANGKAT
         ============================================ -->
    <div class="device-modal" id="add-device-modal">
        <div class="device-modal-content">
            <div class="device-modal-header">
                <h3 id="modal-title"><i class="fas fa-plus-circle"></i> <span data-lang="settings.addDevice">Tambah Perangkat</span></h3>
                <button class="modal-close-btn" onclick="closeAddDeviceModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="add-device-form" onsubmit="handleAddDevice(event)">
                <div class="device-modal-body">
                    <input type="hidden" id="device-type" value="sprinkler">
                    
                    <div class="form-group">
                        <label for="device-id"><i class="fas fa-barcode"></i> <span data-lang="settings.deviceId">Device ID</span> <span class="required">*</span></label>
                        <div class="input-with-prefix">
                            <span class="input-prefix" id="device-id-prefix">SPR-</span>
                            <input type="text" id="device-id" data-lang-placeholder="settings.enterDeviceId" placeholder="Masukkan 12 karakter" maxlength="12" required pattern="[A-Fa-f0-9]{12}">
                        </div>
                        <p class="form-hint" data-lang="settings.deviceIdHint">Masukkan 12 karakter Device ID dari Serial Monitor (contoh: A1B2C3D4E5F6)</p>
                    </div>

                    <div class="form-group">
                        <label for="device-name"><i class="fas fa-tag"></i> <span data-lang="settings.deviceName">Nama Perangkat</span> <span class="required">*</span></label>
                        <input type="text" id="device-name" data-lang-placeholder="settings.deviceNamePlaceholder" placeholder="Contoh: Penyiram Kebun A" required>
                    </div>

                    <div class="form-group">
                        <label for="device-location"><i class="fas fa-map-marker-alt"></i> <span data-lang="settings.locationOptional">Lokasi (Opsional)</span></label>
                        <input type="text" id="device-location" data-lang-placeholder="settings.locationPlaceholder" placeholder="Contoh: Kebun Belakang">
                    </div>

                    <div class="form-group">
                        <label for="device-ip"><i class="fas fa-network-wired"></i> <span data-lang="settings.ipOptional">IP Address (Opsional)</span></label>
                        <input type="text" id="device-ip" data-lang-placeholder="settings.ipPlaceholder" placeholder="Contoh: 192.168.1.100">
                        <p class="form-hint" data-lang="settings.ipHint">Alamat IP perangkat di jaringan lokal Anda</p>
                    </div>
                </div>
                
                <div class="device-modal-footer">
                    <button type="button" class="btn btn-cancel" onclick="closeAddDeviceModal()">
                        <i class="fas fa-times"></i> <span data-lang="common.cancel">Batal</span>
                    </button>
                    <button type="submit" class="btn btn-save">
                        <i class="fas fa-plus"></i> <span data-lang="settings.addDevice">Tambah Perangkat</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ============================================
         MODAL: EDIT PERANGKAT
         ============================================ -->
    <div class="device-modal" id="edit-device-modal">
        <div class="device-modal-content">
            <div class="device-modal-header">
                <h3><i class="fas fa-edit"></i> <span data-lang="settings.editDevice">Edit Perangkat</span></h3>
                <button class="modal-close-btn" onclick="closeEditDeviceModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="edit-device-form" onsubmit="handleEditDevice(event)">
                <div class="device-modal-body">
                    <input type="hidden" id="edit-device-index">
                    <input type="hidden" id="edit-device-type">
                    
                    <div class="form-group">
                        <label><i class="fas fa-barcode"></i> <span data-lang="settings.deviceId">Device ID</span></label>
                        <input type="text" id="edit-device-id" readonly class="readonly-input">
                    </div>

                    <div class="form-group">
                        <label for="edit-device-name"><i class="fas fa-tag"></i> <span data-lang="settings.deviceName">Nama Perangkat</span> <span class="required">*</span></label>
                        <input type="text" id="edit-device-name" required>
                    </div>

                    <div class="form-group">
                        <label for="edit-device-location"><i class="fas fa-map-marker-alt"></i> <span data-lang="settings.deviceLocation">Lokasi</span></label>
                        <input type="text" id="edit-device-location">
                    </div>

                    <div class="form-group">
                        <label for="edit-device-ip"><i class="fas fa-network-wired"></i> <span data-lang="settings.ipAddress">IP Address</span></label>
                        <input type="text" id="edit-device-ip">
                    </div>
                </div>
                
                <div class="device-modal-footer">
                    <button type="button" class="btn btn-cancel" onclick="closeEditDeviceModal()">
                        <i class="fas fa-times"></i> <span data-lang="common.cancel">Batal</span>
                    </button>
                    <button type="submit" class="btn btn-save">
                        <i class="fas fa-save"></i> <span data-lang="settings.saveChanges">Simpan Perubahan</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ============================================
         MODAL: KONFIRMASI HAPUS
         ============================================ -->
    <div class="device-modal" id="delete-device-modal">
        <div class="device-modal-content delete-confirm">
            <div class="device-modal-header delete-header">
                <h3><i class="fas fa-exclamation-triangle"></i> <span data-lang="settings.confirmDelete">Konfirmasi Hapus</span></h3>
            </div>
            <div class="device-modal-body">
                <p class="delete-message" data-lang="settings.deleteMessage">Apakah Anda yakin ingin menghapus perangkat ini?</p>
                <div class="delete-device-info" id="delete-device-info">
                    <strong id="delete-device-name">Nama Perangkat</strong>
                    <span id="delete-device-id">SPR-XXXXXXXXXXXX</span>
                </div>
                <p class="delete-warning"><i class="fas fa-info-circle"></i> <span data-lang="settings.deleteWarning">Tindakan ini tidak dapat dibatalkan.</span></p>
            </div>
            <div class="device-modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeDeleteModal()">
                    <i class="fas fa-times"></i> <span data-lang="common.cancel">Batal</span>
                </button>
                <button type="button" class="btn btn-delete" onclick="confirmDeleteDevice()">
                    <i class="fas fa-trash"></i> <span data-lang="settings.deleteDeviceBtn">Hapus Perangkat</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Pesan notifikasi</span>
    </div>

    <script src="pengaturan.js"></script>
    <script>
        // Auth and User Menu Functions
        const CURRENT_USER_KEY = 'agrismart_current_user';

        function checkAuth() {
            const user = localStorage.getItem(CURRENT_USER_KEY);
            if (!user) {
                window.location.href = 'LOGIN/login.html';
                return null;
            }
            return JSON.parse(user);
        }

        function loadUserInfo() {
            const user = checkAuth();
            if (!user) return;
            
            const userName = document.getElementById('user-name');
            const dropdownFullname = document.getElementById('dropdown-fullname');
            const dropdownEmail = document.getElementById('dropdown-email');
            const settingsUserId = document.getElementById('settings-user-id');
            
            if (userName) userName.textContent = user.fullname?.split(' ')[0] || 'Pengguna';
            if (dropdownFullname) dropdownFullname.textContent = user.fullname || 'Pengguna';
            if (dropdownEmail) dropdownEmail.textContent = user.email || '';
            if (settingsUserId) settingsUserId.textContent = user.userId || 'Tidak tersedia';
        }

        function toggleUserDropdown() {
            const dropdown = document.getElementById('user-dropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }

        function logout() {
            localStorage.removeItem(CURRENT_USER_KEY);
            window.location.href = 'LOGIN/login.html';
        }

        // Copy User ID
        function copyUserId() {
            const userIdElement = document.getElementById('settings-user-id');
            if (userIdElement && userIdElement.textContent !== 'Loading...' && userIdElement.textContent !== 'Tidak tersedia') {
                navigator.clipboard.writeText(userIdElement.textContent).then(() => {
                    showNotification(langManager.t('notifications.userIdCopied'), 'success');
                }).catch(err => {
                    console.error('Gagal menyalin:', err);
                });
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.getElementById('user-menu');
            const dropdown = document.getElementById('user-dropdown');
            
            if (userMenu && dropdown && !userMenu.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Load user info on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
        });
    </script>
</body>
</html>